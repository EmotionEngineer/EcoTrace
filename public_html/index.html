<!DOCTYPE html>
<html>

<head>
    <title>Главная страница - EcoTrace</title>
    <meta charset="utf-8">
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700" rel="stylesheet">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.1/css/mdb.min.css" rel="stylesheet">
    <link href="https://fonts.cdnfonts.com/css/felidae" rel="stylesheet">
    <link href="https://fonts.cdnfonts.com/css/century-gothic" rel="stylesheet">
    <style>
        .blur {
            filter: blur(8px);
        }

        .carousel-item {
            height: 400px;
        }

        .carousel-item img {
            object-fit: cover;
            max-height: 400px;
        }

        #qr-video {
            max-width: 100%;
            max-height: 80vh;
            object-fit: contain;
        }

        .navbar {
            background-color: rgba(255, 255, 255, 0.8);
            /* Semi-transparent white */
            box-shadow: 0px 2px 15px rgba(0, 0, 0, 0.1);
            /* Soft shadow for depth */
        }

        .navbar-brand {
            font-weight: 700;
            color: #333;
            font-family: 'Felidae', sans-serif; /* Применение шрифта Felidae */
        }

        .navbar .navbar-right {
            margin-left: auto;
        }
        
        .navbar-brand img {
            height: 30px; /* Регулируйте высоту логотипа по необходимости */
        }

        /* New color scheme */
        .btn-primary {
            background-color: #388f3c !important;
            border-color: #2f7f33 !important;
        }

        .btn-primary:hover {
            background-color: #2e7d32 !important;
            border-color: #1b5e20 !important;
        }

        .page-footer {
            background-color: #4e342e !important;
            color: #fff !important;
        }

        .carousel-item h2 {
            font-family: 'Felidae', sans-serif; /* Применение шрифта Felidae */
        }

        .carousel-item p {
            font-family: 'Century Gothic', sans-serif; /* Применение шрифта Century Gothic */
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.3.0/dist/jsQR.min.js"></script>
</head>

<body class="grey lighten-3">
    <nav class="navbar navbar-expand-lg">
        <a class="navbar-brand" href=".">
            <img src="logo.png" alt="Logo">
        </a>
        <div class="navbar-right">
            <a class="btn btn-primary" href="desk.php">Личный кабинет</a>
            <a class="btn btn-warning ml-2" href="shop.php">Ярмарка</a>
        </div>
    </nav>

    <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel" style="margin-bottom: 0;">
        <ol class="carousel-indicators">
            <li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
            <li data-target="#carouselExampleIndicators" data-slide-to="1"></li>
            <li data-target="#carouselExampleIndicators" data-slide-to="2"></li>
            <li data-target="#carouselExampleIndicators" data-slide-to="3"></li>
        </ol>
        <div class="carousel-inner">
            <div class="carousel-item active">
                <div class="view">
                    <img class="d-block w-100" src="./carousel/carousel1.png" alt="First slide">
                    <div class="mask rgba-black-light d-flex justify-content-center align-items-center">
                        <div class="text-white text-center">
                            <h2 class="h2-responsive">Подлинность продуктов</h2>
                            <p>Уверенность в происхождении и качестве фермерских продуктов</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="carousel-item">
                <div class="view">
                    <img class="d-block w-100" src="carousel/carousel2.png" alt="Second slide">
                    <div class="mask rgba-black-light d-flex justify-content-center align-items-center">
                        <div class="text-white text-center">
                            <h2 class="h2-responsive">Прозрачность цепи поставок</h2>
                            <p>Отслеживайте продукты от фермы до стола</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="carousel-item">
                <div class="view">
                    <img class="d-block w-100" src="carousel/carousel3.png" alt="Third slide">
                    <div class="mask rgba-black-light d-flex justify-content-center align-items-center">
                        <div class="text-white text-center">
                            <h2 class="h2-responsive">Поддержка локальных фермеров</h2>
                            <p>Поддерживайте экономику вашего сообщества, покупая продукты у местных фермеров</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="carousel-item">
                <div class="view">
                    <img class="d-block w-100" src="carousel/carousel4.png" alt="Fourth slide">
                    <div class="mask rgba-black-light d-flex justify-content-center align-items-center">
                        <div class="text-white text-center">
                            <h2 class="h2-responsive">Свежесть продуктов</h2>
                            <p>Продукты, доставленные прямо от лучших фермеров страны</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Consumer Section -->
    <div class="container my-5 text-center">
        <div class="row justify-content-center">
            <div class="col-lg-6 text-center">
                <h2 class="mb-4">Отследите происхождение вашего продукта</h2>
                <p class="mb-4">Отсканируйте специальный QR-код на упаковке вашего продукта. Это позволит вам узнать все
                    об истории вашего продукта, начиная от фермы и заканчивая вашим столом.</p>
                <button class="btn btn-lg btn-primary mx-auto d-block m-0 px-3 py-2 z-depth-0 waves-effect"
                    onclick="startScan()">Сканировать QR-код продукта</button>
            </div>
        </div>
    </div>

    <div class="modal" tabindex="-1" id="qrModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Сканировать код</h5>
                </div>
                <div class="modal-body d-flex justify-content-center">
                    <video id="qr-video" playsinline></video>
                </div>
            </div>
        </div>
    </div>

    <!-- Calculator section -->
    <div style="background-color: #388f3c; color: white; margin-top: 0; padding: 5em 0;">
        <div class="container my-5 text-center">
            <h2 class="mb-4">Заботьтесь о своем питании</h2>
            <p class="mb-4">Используйте калькулятор калорий, чтобы правильно расчитать свою суточную норму калорийности. Калькулятор поможет вам
                определить количество необходимых калорий в зависимости от вашего образа жизни, возраста, пола и других
                индивидуальных параметров.</p>
            <div class="row justify-content-center">
                <div class="col-lg-6 text-center">
                    <form>
                        <a href="https://primitives.ru/calculator.html">
                            <button type="button"
                                class="btn btn-lg m-0 mt-4 mb-4 px-3 py-2 z-depth-0 waves-effect mx-auto d-block"
                                style="background-color: white; color: #388f3c;">
                                Рассчитать калории
                            </button>
                        </a>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Business Section -->
    <div style="background-color: black; color: white; margin-top: 0; padding: 5em 0;">
        <div class="container my-5 text-center">
            <div class="row justify-content-center">
                <div class="col-lg-8 text-center">
                    <h2 class="mb-4">Бизнес с EcoTrace</h2>
                    <ul style="list-style: none;">
                        <li>Прозрачность цепочки поставок</li>
                        <li>Увеличение доверия к вашему бренду</li>
                        <li>Поддержка ответственного потребления</li>
                        <li>Сотрудничество между фермерами и потребителями</li>
                    </ul>
                    <a href="https://primitives.ru/registration.php">
                        <button class="btn btn-lg m-0 mt-4 mb-4 px-3 py-2 z-depth-0 waves-effect mx-auto d-block"
                            style="background-color: white; color: black;">
                            Начать с EcoTrace
                        </button>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" tabindex="-1" id="productInfoModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Информация о продукте</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p id="supplier"></p>
                    <p id="city"></p>
                    <p id="buyer"></p>
                </div>
            </div>
        </div>
    </div>

    <footer class="page-footer font-small primary-color mt-0">
        <div class="container d-flex align-items-center justify-content-center" style="height: 60px;">
            <p class="text-center mb-0">© 2023 EcoTrace</p>
        </div>
    </footer>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.4/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.1/js/mdb.min.js"></script>
    <script>
        var video = document.getElementById("qr-video");

        function startScan() {
            navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } }).then(function (stream) {
                video.srcObject = stream;
                video.play();
                requestAnimationFrame(tick);
            });

            $('#qrModal').modal('show');
        }

        function tick() {
            if (video.readyState === video.HAVE_ENOUGH_DATA) {
                let canvas = document.createElement('canvas');
                canvas.height = video.videoHeight;
                canvas.width = video.videoWidth;
                let ctx = canvas.getContext('2d');
                ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

                let imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                let code = jsQR(imageData.data, imageData.width, imageData.height);

                if (code) {
                    console.log("Found QR code", code.data);
                    $('#qrModal').modal('hide');
                    video.srcObject.getTracks().forEach(track => track.stop());
                    trackProduct(code.data);
                }
            }

            requestAnimationFrame(tick);
        }

        function trackProduct(qrCode) {
            var qrUrl = new URL(qrCode);
            var contractKey = qrUrl.searchParams.get('contract_key');
            
            // Перенаправляем на страницу с информацией о продукте
            window.location.href = 'search-qr.php?contractKey=' + contractKey;
        }

        function calculateCalories() {
            var weight = document.getElementById("weightInput").value;
            var height = document.getElementById("heightInput").value;
            var age = document.getElementById("ageInput").value;
            var gender = document.getElementById("genderInput").value;
            var activityLevel = document.getElementById("activityLevelInput").value;

            if (weight == "" || height == "" || age == "") {
                alert("Пожалуйста, заполните все поля");
                return;
            }

            var bmr;
            if (gender === "male") {
                bmr = 88.36 + (13.4 * weight) + (4.8 * height) - (5.7 * age);
            } else {
                bmr = 447.6 + (9.2 * weight) + (3.1 * height) - (4.3 * age);
            }

            var pal;
            if (activityLevel == "1") {
                pal = 1.2;
            } else if (activityLevel == "2") {
                pal = 1.375;
            } else if (activityLevel == "3") {
                pal = 1.55;
            } else if (activityLevel == "4") {
                pal = 1.725;
            } else {
                pal = 1.9;
            }

            var dailyCalories = Math.round(bmr * pal);
            document.getElementById("calorieOutput").textContent = dailyCalories + " ккал";
        }
    </script>
</body>

</html>